document.addEventListener(\'DOMContentLoaded\', () => {\n    const explainBtn = document.getElementById(\'explain-btn\');\n    const inputCodeEl = document.getElementById(\'input-code\');\n    const languageEl = document.getElementById(\'language\');\n    const apiKeyEl = document.getElementById(\'api-key\');\n    const resultArea = document.getElementById(\'result-area\');\n\n    explainBtn.addEventListener(\'click\', async () => {\n        const code = inputCodeEl.value.trim();\n        const lang = languageEl.value.trim();\n        const API_KEY = apiKeyEl.value.trim();\n\n        if (!code) {\n            alert(\'コードを入力してください。\');\n            return;\n        }\n\n        if (!API_KEY) {\n            alert(\'Google AI APIキーを入力してください。\');\n            return;\n        }\n\n        // モデル名を gemini-1.5-flash に変更\n        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;\n\n        resultArea.textContent = \'AIがコードを解説しています...\';\n        explainBtn.disabled = true;\n\n        try {\n            let prompt = `以下のコードを分かりやすく解説してください。コードの機能、各部分の役割、全体的な仕組みについて説明してください。\\n\\n`;\n            if (lang) {\n                prompt += `言語: ${lang}\\n`;\n            }\n            prompt += `コード:\\n\`\`\`${lang || \'\'}\\n${code}\\n\`\`\``;\n\n            const response = await fetch(API_URL, {\n                method: \'POST\',\n                headers: {\n                    \'Content-Type\': \'application/json\',\n                },\n                body: JSON.stringify({\n                    contents: [{\n                        parts: [{\n                            text: prompt\n                        }]\n                    }]\n                })\n            });\n\n            if (!response.ok) {\n                const errorData = await response.json();\n                throw new Error(`APIエラー: ${response.status} - ${errorData.error.message}`);\n            }\n\n            const data = await response.json();\n            const text = data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0] && data.candidates[0].content.parts[0].text;\n            \n            if (text) {\n                resultArea.textContent = text;\n            } else {\n                resultArea.textContent = \'AIからの応答がありませんでした。APIキーが正しいか、または入力内容を変更して再度お試しください。\';\n            }\n\n        } catch (error) {\n            console.error(\'Error:\', error);\n            resultArea.textContent = `エラーが発生しました。(${error.message})\\nコンソールで詳細を確認してください。`;\n        } finally {\n            explainBtn.disabled = false;\n        }\n    });\n});